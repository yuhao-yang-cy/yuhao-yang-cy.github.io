<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> 一维 PD 控制器 | Colin Young's Personal Site </title> <meta name="author" content="Colin Young"> <meta name="description" content="来自 Coursera 的一门关于飞行器基础理论和应用的公开课笔记"> <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https:; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https:; font-src 'self' data: https:; media-src 'self' https:; frame-src 'self' https:; connect-src 'self' https:;"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?v=a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?v=f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?v=62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?v=591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?v=d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://yuhao-yang-cy.github.io//blog/2021/1D-PD-controller/"> <script src="/assets/js/theme.js?v=5fea5159b787642c1bbc1f334d60f883"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?v=5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Colin Young's Personal Site </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">home </a> </li> <li class="nav-item "> <a class="nav-link" href="/bio/">bio </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">posts </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/books/">bookshelf </a> </li> <li class="nav-item "> <a class="nav-link" href="/news/">logs </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="fa-solid fa-magnifying-glass"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-half-sun-moon" id="light-toggle-system"></i> <i class="fa-solid fa-moon" id="light-toggle-dark"></i> <i class="fa-solid fa-sun" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">一维 PD 控制器</h1> <p class="post-meta"> Created on September 11, 2021 </p> <p class="post-tags"> <a href="/blog/2021"> <i class="fa-solid fa-calendar fa-sm"></i> 2021 </a>   ·   <a href="/blog/tag/engineering"> <i class="fa-solid fa-hashtag fa-sm"></i> engineering</a>   <a href="/blog/tag/control"> <i class="fa-solid fa-hashtag fa-sm"></i> control</a>   <a href="/blog/tag/robotics"> <i class="fa-solid fa-hashtag fa-sm"></i> robotics</a>   ·   <a href="/blog/category/engineering"> <i class="fa-solid fa-tag fa-sm"></i> engineering</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>最近学新东西劲头比较足。上个月在 Coursera 的一门关于飞行器基础理论和应用的公开课，加上自己又在重新回炉自己的 Python 技能，就想着配合自己的理解和借助 Python 模拟出来的图像，把公开课里学到的东西给写出来。这篇先来介绍下在公开课里学到的 PD 控制器（PD controller），仅限于一维的运动控制。之后的灌水文章会来写写推广二维和三维的运动控制。</p> <h2 id="概述">概述</h2> <p>在无人机运行时，我们可能会期望飞行器能够沿着某个预定的路径飞行。但实际的飞行路径总是会或多或少地和原定的路径有些许的偏差。自然地，亟待解决的问题就是，我们该如何控制飞行器，使得它的飞行路线准确而又稳定呢？</p> <p>不难想到，解决方案的大体思路可以是这样：我们通过传感器时刻追踪测量实时路径，然后把收集到的数据和参考值进行对比，计算出两者之间的偏差，然后根据这个误差来调整动力输出，使得误差可以得到修正。也就是说，整个控制回路会包括三个主要部分：</p> <ol> <li>传感器测量实时数据</li> <li>控制器做出决定</li> <li>输出设备做出响应</li> </ol> <p>控制应用中一种很常见的控制回路就是这里要介绍的 PD 控制器，它以两种纠正算法得名：PD 控制器由比例单元（Proportional）和微分单元（Derivative）组成，受控变数是比例算法和微分算法两者相加后的结果。</p> <h2 id="原理">原理</h2> <p>在本篇中，我们先讨论一维系统中的 PD 控制机制。针对无人机，我们只考虑竖直方向这个维度的运动，也就是说，我们的目标是让无人机能在尽可能短的时间内达到既定高度。我们期望的无人机高度可以是一个时间 \(t\) 的函数，记为 \(z^\text{des}(t)\)，这里的上标 des 来自英文 desired 的缩写。控制器测量得到的无人机在 \(t\) 时刻的实际高度记为 \(z(t)\)。我们可以进而引入误差函数（error function）：</p> \[e(t) = z^\text{des}(t) - z(t) \tag{1}\] <p>这个控制问题的目标就变成了：该如何调整合适的输出，使得误差函数 \(e(t)\) 迅速地衰减到零？</p> <p>在公开课的视频中，教授给了一个很棒的类比。这个问题可以跟弹簧振子的运动行为联系起来。在弹簧提供的回复力的影响下，不论振子的初始位置在哪里，它总是会有往平衡位置加速的趋势。引入适当的阻力，振子的振幅可以不断减小，最终趋于零。也就是说，在弹簧回复力和系统内部阻力的共同作用下，原则上可以让振子的位移在一段时间后变成零。呵，是不是听起来跟手头要解决的控制问题有点像了！</p> <p>典型的弹簧振子模型中，弹簧给出的回复力符合胡克定律 \(T=kx\)，阻力的大小可以假定正比于运动速度 \(f=\alpha \dot{x}\)，系统的运动方程可以写作</p> \[m\ddot{x} = -kx - \alpha \dot{x}\] <p>上式右边的两个负号是因为回复力方向与位移方向相反，以及阻力的方向与速度方向相反。稍作改写，可以把式子写成：</p> \[\ddot{x} + B\dot{x} + Cx = 0 \qquad \left(B=\frac{\alpha}{m}, \;C=\frac{k}{m}\right)\] <p>这是的 \(B\) 和 \(C\) 是两个大于零的常数，因此这个方程是一个标准的常系数二阶微分方程，方程的解将具有 \(x(t)\sim\mathrm{e}^{\lambda t}\) 的形式。可以证明，对应于不同的正的 \(B\) 和 \(C\) 的取值，位移函数 \(x\) 总会趋于零：它或将会随时间指数衰减趋于零（\(B^2 &gt; 4C\) 即阻尼影响较强的情况），或将会作振幅不断减小的往复振动最终收敛至零（\(B^2 &lt; 4C\) 即回复力影响较强的情况）。</p> <p>回到控制问题来。类比于弹簧振子，如果能够控制飞行器输出一个合适的动力，从而使得误差函数可以满足微分方程：</p> \[\ddot{e} + K_d \dot{e} + K_pe = 0 \tag{2}\] <p>那么，飞行器实际位置与预定位置之间的误差也将会逐渐趋于零。上式中，\(K_p\) 项和 \(K_d\) 项分别正比于误差函数自身和误差函数的导数，所以这 \(K_p\) 和 \(K_d\) 这两个参数就被称为比例增益（proportional gain）和微分增益（derivative gain）。</p> <p>知道了大方向后，我们就可以反过来问：动力输出应该如何调整呢？将 \((1)\) 式代入 \((2)\) 式中，得到</p> \[\ddot{z}^\text{des} - \ddot{z} + K_d (\dot{z}^\text{des} - \dot{z}) + K_p ( z^\text{des} - z) = 0\] <p>其中，\({z}^\text{des}\)、\(\dot{z}^\text{des}\)、\(\ddot{z}^\text{des}\) 取决于预先设计的规划路线，都是事先已知的函数；\(z\)、\(\dot{z}\) 是可以通过传感器实时测量，剩下的就只需要让 \(\ddot{z}\) 跟着其他项的脸色办事就好了。不难得出，\(\ddot{z}\) 现在需要满足的等式是</p> \[\ddot{z} = \ddot{z}^\text{des} + K_d (\dot{z}^\text{des} - \dot{z}) + K_p ( z^\text{des} - z) = 0\tag{3}\] <p>而 \(\ddot{z}\) 代表的是飞行器的加速度，这正是可以通过调节动力输出来改变的物理量。控制器现在可以通过 \((3)\) 式计算出每时每刻飞行器应该具有的加速度，输出设备可以由此作出反应，从而逐渐消除飞行器与预定位置的偏差。</p> <p>选择不同的常数 \(K_p\) 和 \(K_d\)，我们还可以控制误差函数 \(e(t)\) 趋于零的方式和速度。实际操作中，可以去尝试各种 \(K_p\) 和 \(K_d\) 的组合，找出可以让 \(e(t)\) 快速趋于零的最优方案。</p> <h2 id="测试">测试</h2> <p>先来测试一种很简单的情况：飞行器从地面起飞，快速上升到既定高度，之后保持悬停不动。</p> <p>如果我们选取比较大的 \(K_p\) 和比较小的 \(K_d\)，模拟出来的实际路线如下图所示。类比弹簧振子系统，这种情况好比回复力很强，因此振子从远端可以很快启动冲往平衡位置。但是由于阻尼相对较弱，振子有点刹不住车，会冲到平衡位置另一端，继而作来回往复的振动。随着振幅不断减小，在多个周期之后，逐渐贴近期待的平衡点。由于存在“冲过头”的现象，这种控制模式的稳定性欠佳。</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/1D-controller-test-1-480.webp 480w,/assets/img/1D-controller-test-1-800.webp 800w,/assets/img/1D-controller-test-1-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/1D-controller-test-1.png" class="img-natural rounded z-depth-1" width="100%" height="auto" title="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>如果我们选择比较大的 \(K_d\) 和比较小的 \(K_p\)，模拟出来的路线如下图。依然类比弹簧振子，这时就好比一个回复力不是很强、但是阻力极大的系统，振子跑回平衡位置举步维艰，最终要用很长的时间到达平衡点。虽然不会跑过头，但是收敛的速度太慢了，因此控制的结果也不是很理想。</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/1D-controller-test-2-480.webp 480w,/assets/img/1D-controller-test-2-800.webp 800w,/assets/img/1D-controller-test-2-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/1D-controller-test-2.png" class="img-natural rounded z-depth-1" width="100%" height="auto" title="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>所以，最优的 PD 控制应该选取足够大的 \(K_p\)，保证在与预定位置偏离较远时能够即刻启动，朝着目标位置加速冲过去；但也要有足够大的 \(K_d\)，保证在快到预定位置之前，能够赶紧减速以免冲过头。但 \(K_d\) 也不适宜取得太大，否则就会压制 \(K_p\) 项的回复效果。模拟中得到的一个比较好的结果如下图所示，显示飞行器在1秒左右的时间内就上升到了预定高度，之后就稳定地悬停，没有多余地上下晃动，属于比较理想的控制。</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/1D-controller-test-3-480.webp 480w,/assets/img/1D-controller-test-3-800.webp 800w,/assets/img/1D-controller-test-3-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/1D-controller-test-3.png" class="img-natural rounded z-depth-1" width="100%" height="auto" title="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>我们还可以设计更为复杂的路线进行测试。比如，让飞行器连续在几个不同的高度悬停。利用先前的 PD 控制参数，可以看到模拟的结果也是很不错的。</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/1D-controller-test-4-480.webp 480w,/assets/img/1D-controller-test-4-800.webp 800w,/assets/img/1D-controller-test-4-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/1D-controller-test-4.png" class="img-natural rounded z-depth-1" width="100%" height="auto" title="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>我们也可以让飞行器的高度按着预定的函数连续地变化（也许合着音乐的节拍上下摇摆）。对于这种连续的、没有突变的高度变化，PD 控制器可以应付得更加漂亮。下面的模拟结果中可以看到，飞行器的高度除了在刚开始与预定值稍有偏差，之后实际高度和预定高度几乎完全重合在了一起。甚至在大幅度范围内去调 \(K_p\) 和 \(K_d\) 的值，这种高度重合的结果都可以复现出来。</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/1D-controller-test-5-480.webp 480w,/assets/img/1D-controller-test-5-800.webp 800w,/assets/img/1D-controller-test-5-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/1D-controller-test-5.png" class="img-natural rounded z-depth-1" width="100%" height="auto" title="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/1D-controller-test-6-480.webp 480w,/assets/img/1D-controller-test-6-800.webp 800w,/assets/img/1D-controller-test-6-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/1D-controller-test-6.png" class="img-natural rounded z-depth-1" width="100%" height="auto" title="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> </div> </article> </div> <style>.img-natural{max-width:90%;width:auto!important;height:auto;display:block;margin-left:auto;margin-right:auto}h2{color:var(--global-bg-color);background:var(--global-theme-color);line-height:1.6em;border-radius:3px;padding:2px;display:inline-block}</style> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2026 Colin Young. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?v=a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?v=85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?v=2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?v=c15de51d4bb57887caa2c21988d97279"></script> <script defer src="/assets/js/copy_code.js?v=c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?v=d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?v=a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?v=2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?v=f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?v=a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?v=6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?v=ccc841c459bfc0e64c1c2b5acd10df02"></script> </body> </html>